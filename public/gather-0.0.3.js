var gather=function(){"use strict";function e(e,t){var n={};for(var r in e)n[r]=e[r];return n.target=n.currentTarget=t,n}var t,n=["load","loadend","timeout","error","readystatechange","abort"],r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],c=n[5];function u(e){return e.watcher||(e.watcher=document.createElement("a"))}function d(t,n){var r,o=t.getProxy(),i="on"+n+"_",a=e({type:n},o);o[i]&&o[i](a),"function"==typeof Event?r=new Event(n,{bubbles:!1}):(r=document.createEvent("Event")).initEvent(n,!1,!0),u(t).dispatchEvent(r)}function f(e){this.xhr=e,this.xhrProxy=e.getProxy()}function h(e){function t(e){f.call(this,e)}return t.prototype=Object.create(f.prototype),t.prototype.next=e,t}f.prototype=Object.create({resolve:function(e){var t=this.xhrProxy,n=this.xhr;t.readyState=4,n.resHeader=e.headers,t.response=t.responseText=e.response,t.statusText=e.statusText,t.status=e.status,d(n,s),d(n,r),d(n,o)},reject:function(e){this.xhrProxy.status=0,d(this.xhr,e.type),d(this.xhr,o)}});var l=h((function(e){var t=this.xhr;for(var n in e=e||t.config,t.withCredentials=e.withCredentials,t.open(e.method,e.url,!1!==e.async,e.user,e.password),e.headers)t.setRequestHeader(n,e.headers[n]);t.send(e.body)})),w=h((function(e){this.resolve(e)})),g=h((function(e){this.reject(e)}));function p(t){var r=t.onRequest,o=t.onResponse,f=t.onError;function h(e,t,n){var r=new g(e),o={config:e.config,error:n};f?f(o,r):r.next(o)}function p(){return!0}function v(e,t){return h(e,0,t),!0}function x(e,t){return 4===e.readyState&&0!==e.status?function(e,t){var n=new w(e);if(!o)return n.resolve();var r={response:t.response,status:t.status,statusText:t.statusText,config:e.config,headers:e.resHeader||e.getAllResponseHeaders().split("\r\n").reduce((function(e,t){if(""===t)return e;var n=t.split(":");return e[n.shift()]=function(e){return e.replace(/^\s+|\s+$/g,"")}(n.join(":")),e}),{})};o(r,n)}(e,t):4!==e.readyState&&d(e,s),!0}return function(t){function n(e){return function(){var n=this.hasOwnProperty(e+"_")?this[e+"_"]:this.xhr[e],r=(t[e]||{}).getter;return r&&r(n,this)||n}}function r(n){return function(r){var o=this.xhr,i=this,a=t[n];if("on"===n.substring(0,2))i[n+"_"]=r,o[n]=function(a){a=e(a,i),t[n]&&t[n].call(i,o,a)||r.call(i,a)};else{var s=(a||{}).setter;r=s&&s(r,i)||r,this[n+"_"]=r;try{o[n]=r}catch(e){}}}}function o(e){return function(){var n=[].slice.call(arguments);if(t[e]){var r=t[e].call(this,n,this.xhr);if(r)return r}return this.xhr[e].apply(this.xhr,n)}}return window._rxhr=window._rxhr||XMLHttpRequest,XMLHttpRequest=function(){var e=new window._rxhr;for(var t in e){var i="";try{i=typeof e[t]}catch(e){}"function"===i?this[t]=o(t):Object.defineProperty(this,t,{get:n(t),set:r(t),enumerable:!0})}var a=this;e.getProxy=function(){return a},this.xhr=e},window._rxhr}({onload:p,onloadend:p,onerror:v,ontimeout:v,onabort:v,onreadystatechange:function(e){return x(e,this)},open:function(t,n){var o=this,u=n.config={headers:{}};u.method=t[0],u.url=t[1],u.async=t[2],u.user=t[3],u.password=t[4],u.xhr=n;var d="on"+s;n[d]||(n[d]=function(){return x(n,o)});var f=function(t){h(n,0,e(t,o))};if([a,i,c].forEach((function(e){var t="on"+e;n[t]||(n[t]=f)})),r)return!0},send:function(e,t){var n=t.config;if(n.withCredentials=t.withCredentials,n.body=e[0],r){var o=function(){r(n,new l(t))};return!1===n.async?o():setTimeout(o),!0}},setRequestHeader:function(e,t){return t.config.headers[e[0].toLowerCase()]=e[1],!0},addEventListener:function(t,r){var o=this;if(-1!==n.indexOf(t[0])){var i=t[1];return u(r).addEventListener(t[0],(function(n){var r=e(n,o);r.type=t[0],r.isTrusted=!0,i.call(o,r)})),!0}},getAllResponseHeaders:function(e,t){var n=t.resHeader;if(n){var r="";for(var o in n)r+=o+": "+n[o]+"\r\n";return r}},getResponseHeader:function(e,t){var n=t.resHeader;if(n)return n[(e[0]||"").toLowerCase()]}})}var v=function(){return(v=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},x=function(e){var t=e?new Date(e):new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+":"+t.getMilliseconds()},m=function(){var e=window.localStorage.getItem("NR_GATHER_UID");return e||(e="xxxxxxxxyxxxyxxxyxxxyxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),window.localStorage.setItem("NR_GATHER_UID",e)),{uuid:e,nr_uuid:window.localStorage.getItem("NR_GATHER_USER_UID")||e}},y=function(){var e,t,n,r,o,i=window.navigator.connection,a=m(),s=a.uuid,c=a.nr_uuid;return{o:window.location.href,ua:(t=window.navigator.userAgent,n=t.indexOf("("),r=t.indexOf(")")+1,o=navigator.userAgent.toLocaleLowerCase(),e=t.substring(n,r),t.indexOf("Trident")>-1?e+" IE":/Presto/i.test(t)?e+" opera":/Chrome\/([\d.]+)/.test(t)||/CriOS\/([\d.]+)/.test(t)?e+" chrome":/safari/i.test(t)&&!/Chrome/i.test(t)?e+" safari":t.indexOf("AppleWebKit")>-1?e+" safari or chrome":t.indexOf("Gecko")>-1&&-1===t.indexOf("KHTML")?e+" firefox":/micromessenger/i.test(t)?e+" wechat":o.match(/tencenttraveler/)||o.match(/qqbrowse/)?e+" qq":e+" none"),ul:window.navigator.language,ct:i?i.effectiveType:"",vp:(document.documentElement.clientWidth||document.body.clientWidth)+"*"+(document.documentElement.clientHeight||document.body.clientHeight),sr:screen.width+"*"+screen.height,uid:s,uuid:c,gmt:x(),key:window.gather_config.key,dpr:window.devicePixelRatio,rf:document.referrer}};var _=function(){var e=window.sessionStorage.getItem("NR_TRADE_GATHER_LIST");return e?JSON.parse(e):[]},E=_(),S=function(e){return E.push(e),window.sessionStorage.setItem("NR_TRADE_GATHER_LIST",JSON.stringify(E)),E.length>=window.gather_config.tthreshold?E.slice(0,window.gather_config.tthreshold):void 0},b=!1;function R(e){var t=S(e);if(t&&!b){b=!0;var n=new FormData;n.append("value",JSON.stringify(t)),fetch(window.gather_config.url,{credentials:"include",method:"post",body:n}).then((function(){b=!1,E.splice(0,window.gather_config.tthreshold),window.sessionStorage.clear()})).catch((function(e){b=!1,console.log(e)}))}}var T="",H=Date.now(),L=function(){R(v(v({},y()),{pathname:window.location.href,from:T,title:document.title,type:"pv",stay:Date.now()-H})),T=window.location.href},O=function(e){var t=history[e],n=new Event(e);return function(){var e=t.apply(this,arguments);return window.dispatchEvent(n),e}},q=function(){return setTimeout((function(){return R(function(){var e=window.performance.timing;if("function"==typeof window.PerformanceNavigationTiming)try{var t=window.performance.getEntriesByType("navigation")[0];t&&(e=t)}catch(e){}return v(v({},y()),{type:"performance",dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,ttfb:e.responseStart-e.fetchStart,bt:e.domInteractive-e.fetchStart,dt:e.domComplete-e.domInteractive,drt:e.domContentLoadedEventEnd-e.fetchStart,rt:e.responseEnd-e.responseStart,lt:e.loadEventEnd-e.fetchStart,nv:window.performance.navigation.type})}())}),window.gather_config.outtime)},D=function(e){var t,n;e instanceof ErrorEvent?R((n=e,v(v({},y()),{type:"error",st:"js",file:n.filename,msg:n.message}))):(null===(t=e.target)||void 0===t?void 0:t.src)!==window.location.href&&R(function(e){return v(v({},y()),{type:"error",st:"resource",file:e.target.src,msg:e.target.outerHTML})}(e))},I=function(e){return R(function(e){return console.log("errr==>",e.reason,"promise"),v(v({},y()),{type:"error",st:"promise",msg:e.reason,file:""})}(e))};return window.gather_config=Object.assign({},{url:"/xdnphb/nr/app/ade/explain/page/addPageRqInfo2Log",key:"",outtime:300,performance:!0,static:!0,error:!0,filterStatic:["fetch","xmlhttprequest"],isSPA:!1,tthreshold:10},window.gather_config),window.gather_config.key&&["pc","pc_seo","mobile_zmb","mobile_sqb","mobile_cps","mobile_dytg","mobile_hxb","mobile_other",""].includes(window.gather_config.key)?(function(e){if(t)throw"Proxy already exists";t=new p(e)}({onRequest:function(e,t){e.headers.rq=Date.now(),t.next(e)},onError:function(e,t){return t.next(e)},onResponse:function(e,t){R(function(e){var t=e.config||{},n=t.url,r=t.headers,o=r?r.rq:0,i=n?n.split("?")[0]:"",a=Date.now();return v(v({},y()),{type:"interface",url:i,rq:x(o),rp:x(a),cd:e.status||0,tc:a-o})}(e)),function(e){var t=e.config,n=e.response,r=t?t.url:"";try{var o=n?JSON.parse(n):{value:{user:{}}};r.includes("/xdnphb/common/account/get")&&window.localStorage.setItem("NR_GATHER_USER_UID",o.value.user.uuid)}catch(e){}}(e),t.next(e)}}),window.addEventListener("error",D,!0),window.addEventListener("unhandledrejection",I,!1),window.addEventListener("load",q,!1),function(){L();var e=function(){return L()};history.pushState=O("pushState"),history.replaceState=O("replaceState"),window.addEventListener("popstate",e),window.addEventListener("pushState",e),window.addEventListener("unload",(function(){if("sendBeacon"in window.navigator){var e=_(),t=new FormData;t.append("value",JSON.stringify(e)),window.navigator.sendBeacon(window.gather_config.url,t),window.sessionStorage.clear()}}))}()):console.warn("没有配置对应项目的key值，或者配置的key值不正确。无法进行检测~"),{sendData:R,getBaseMsg:y}}();
